# Exit early for non-interactive shells
[[ $- != *i* ]] && return

export EDITOR=vim
export VISUAL=vim
export PAGER=less

# History
export HISTSIZE=10000
export SAVEHIST=20000
export HISTFILE=~/.zsh_history
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_SAVE_NO_DUPS
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY
setopt SHARE_HISTORY
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY
export HIST_STAMPS='%F %T '

# Safer defaults
set -o noclobber  # Prevent accidental overwrites with >
setopt CHECK_JOBS
setopt HASH_CMDS
setopt HASH_DIRS

# Source functions first (needed for prompt)
source ~/.dotfiles/zsh/functions.sh

# Prompt (simple + informative with git branch)
# Note: zsh prompt uses %v for vcs_info, but we use a simple function for compatibility
setopt PROMPT_SUBST
PS1='%n@%m:%~$(parse_git_branch)%# '

# Enable completion system
autoload -Uz compinit
compinit

command -v direnv >/dev/null && eval "$(direnv hook zsh)"

# Add user bin directories to PATH if they exist
[ -d "$HOME/bin" ] && path-prepend "$HOME/bin"
[ -d "$HOME/.dotfiles/bin" ] && path-prepend "$HOME/.dotfiles/bin"

# Source extras
source ~/.dotfiles/zsh/aliases.sh
source ~/.dotfiles/zsh/env.sh
