# Exit early for non-interactive shells
[[ $- != *i* ]] && return

# Determine dotfiles location
if [ -n "$DOTFILES" ]; then
    DOTFILES_DIR="$DOTFILES"
elif [ -d "$HOME/.dotfiles" ]; then
    DOTFILES_DIR="$HOME/.dotfiles"
else
    DOTFILES_DIR="$HOME/.dotfiles"  # fallback
fi

export EDITOR=vim
export VISUAL=vim
export PAGER=less

# History
export HISTSIZE=10000
export HISTFILESIZE=20000
export HISTCONTROL=ignoreboth:erasedups
export HISTTIMEFORMAT='%F %T '
shopt -s histappend
shopt -s checkwinsize
shopt -s cmdhist

# Safer defaults
set -o noclobber  # Prevent accidental overwrites with >
shopt -s checkhash
shopt -s checkjobs

# Source functions first (needed for prompt)
source $DOTFILES_DIR/bash/functions.sh

# Prompt (simple + informative with git branch)
PS1='\u@\h:\w$(parse_git_branch)\$ '

command -v direnv >/dev/null && eval "$(direnv hook bash)"

# Add user bin directories to PATH if they exist
[ -d "$HOME/bin" ] && path-prepend "$HOME/bin"
[ -d "$DOTFILES_DIR/bin" ] && path-prepend "$DOTFILES_DIR/bin"

# Source extras
source $DOTFILES_DIR/bash/aliases.sh
source $DOTFILES_DIR/bash/env.sh
